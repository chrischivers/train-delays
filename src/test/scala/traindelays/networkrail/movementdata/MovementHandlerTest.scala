package traindelays.networkrail.movementdata

import cats.effect.IO
import fs2.async
import org.scalatest.FlatSpec
import traindelays.networkrail.MockStompClient
import org.scalatest.Matchers._

import scala.concurrent.ExecutionContext.Implicits.global

class MovementHandlerTest extends FlatSpec {

  it should "receive movements message and parse/decode" in {

    async
      .unboundedQueue[IO, MovementRecord]
      .map { queue =>
        val mockStompClient = MockStompClient()
        val listener        = new MovementsHandlerWatcher(queue)
        mockStompClient.client.subscribe("test/topic", listener).unsafeRunSync()

        mockStompClient.sendMessage("test/topic", sampleMovementMessage)
        listener.rawMessagesReceived should have size 1
        queue.dequeueBatch1(100).unsafeRunSync().toList should have size 32
      }
      .unsafeRunSync()
  }

  val sampleMovementMessage =
    """[{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663136000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"1514663100000","original_loc_stanox":"","planned_timestamp":"1514663100000","timetable_variation":"0","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"2","reporting_stanox":"24799","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 2","division_code":"23","train_terminated":"false","train_id":"172N37MX30","offroute_ind":"false","variation_status":"ON TIME","train_service_code":"11810920","toc_id":"23","loc_stanox":"24799","auto_expected":"true","direction_ind":"DOWN","route":"1","planned_event_type":"DEPARTURE","next_report_stanox":"25016","line_ind":"C"}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663136000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"1514662980000","original_loc_stanox":"","planned_timestamp":"1514663010000","timetable_variation":"2","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"false","next_report_run_time":"2","reporting_stanox":"00000","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"64","train_terminated":"false","train_id":"362G71MY30","offroute_ind":"false","variation_status":"LATE","train_service_code":"12303012","toc_id":"64","loc_stanox":"36078","auto_expected":"true","direction_ind":"UP","route":"1","planned_event_type":"DEPARTURE","next_report_stanox":"36080","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663136000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514662950000","timetable_variation":"2","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"12","reporting_stanox":"30139","actual_timestamp":"1514663040000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"23","train_terminated":"false","train_id":"301B35MY30","offroute_ind":"false","variation_status":"LATE","train_service_code":"21737000","toc_id":"23","loc_stanox":"30139","auto_expected":"true","direction_ind":"DOWN","route":"1","planned_event_type":"DEPARTURE","next_report_stanox":"29150","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663137000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514663160000","timetable_variation":"0","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"1","reporting_stanox":"52736","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"30","train_terminated":"false","train_id":"521T821Y30","offroute_ind":"false","variation_status":"ON TIME","train_service_code":"21235001","toc_id":"30","loc_stanox":"52736","auto_expected":"true","direction_ind":"","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"51938","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663137000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514661510000","timetable_variation":"28","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"false","next_report_run_time":"6","reporting_stanox":"00000","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"27","train_terminated":"false","train_id":"071V62MI30","offroute_ind":"false","variation_status":"LATE","train_service_code":"22180008","toc_id":"27","loc_stanox":"83011","auto_expected":"true","direction_ind":"DOWN","route":"1","planned_event_type":"DEPARTURE","next_report_stanox":"83028","line_ind":"M"}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663137000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514663100000","timetable_variation":"0","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"3","reporting_stanox":"52739","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"21","train_terminated":"false","train_id":"471B071Y30","offroute_ind":"false","variation_status":"ON TIME","train_service_code":"21911000","toc_id":"21","loc_stanox":"52739","auto_expected":"true","direction_ind":"UP","route":"3","planned_event_type":"DEPARTURE","next_report_stanox":"52741","line_ind":"S"}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663137000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514663040000","timetable_variation":"1","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"4","reporting_stanox":"54001","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 3","division_code":"61","train_terminated":"false","train_id":"541D30MY30","offroute_ind":"false","variation_status":"LATE","train_service_code":"21703001","toc_id":"61","loc_stanox":"54001","auto_expected":"true","direction_ind":"DOWN","route":"1","planned_event_type":"DEPARTURE","next_report_stanox":"53401","line_ind":"F"}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663137000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"1514663220000","original_loc_stanox":"","planned_timestamp":"1514663190000","timetable_variation":"0","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"1","reporting_stanox":"87214","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 7","division_code":"84","train_terminated":"false","train_id":"862F60MY30","offroute_ind":"false","variation_status":"ON TIME","train_service_code":"24673605","toc_id":"84","loc_stanox":"87214","auto_expected":"true","direction_ind":"UP","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"87212","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663137000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"1514662800000","original_loc_stanox":"","planned_timestamp":"1514662770000","timetable_variation":"7","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"1","reporting_stanox":"87169","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"84","train_terminated":"false","train_id":"872H62MY30","offroute_ind":"false","variation_status":"LATE","train_service_code":"24673105","toc_id":"84","loc_stanox":"87169","auto_expected":"true","direction_ind":"UP","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"87271","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663137000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514663100000","timetable_variation":"1","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"1","reporting_stanox":"87169","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"84","train_terminated":"false","train_id":"872G62MY30","offroute_ind":"false","variation_status":"LATE","train_service_code":"24673505","toc_id":"84","loc_stanox":"87169","auto_expected":"true","direction_ind":"","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"87271","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663137000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514663310000","timetable_variation":"3","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"7","reporting_stanox":"87248","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"80","train_terminated":"false","train_id":"892H841X30","offroute_ind":"false","variation_status":"EARLY","train_service_code":"24655005","toc_id":"80","loc_stanox":"87248","auto_expected":"true","direction_ind":"UP","route":"2","planned_event_type":"DEPARTURE","next_report_stanox":"87208","line_ind":"C"}},{"header":{"msg_type":"0003","source_dev_id":"VR1C","user_id":"#QDP4133","original_data_source":"SDR","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514663250000","timetable_variation":"2","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"1","reporting_stanox":"64231","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"MANUAL","train_file_address":null,"platform":"","division_code":"71","train_terminated":"false","train_id":"801W71MQ30","offroute_ind":"false","variation_status":"EARLY","train_service_code":"25432000","toc_id":"71","loc_stanox":"64231","auto_expected":"true","direction_ind":"","route":"","planned_event_type":"DEPARTURE","next_report_stanox":"64230","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"1514663040000","original_loc_stanox":"","planned_timestamp":"1514663040000","timetable_variation":"1","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"false","next_report_run_time":"2","reporting_stanox":"00000","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 2","division_code":"30","train_terminated":"false","train_id":"722C45MY30","offroute_ind":"false","variation_status":"LATE","train_service_code":"22216000","toc_id":"30","loc_stanox":"72002","auto_expected":"true","direction_ind":"UP","route":"2","planned_event_type":"DEPARTURE","next_report_stanox":"72001","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"1514663100000","original_loc_stanox":"","planned_timestamp":"1514663070000","timetable_variation":"2","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"false","next_report_run_time":"1","reporting_stanox":"00000","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"80","train_terminated":"false","train_id":"881J881Y30","offroute_ind":"false","variation_status":"LATE","train_service_code":"24653005","toc_id":"80","loc_stanox":"88319","auto_expected":"true","direction_ind":"UP","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"88317","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"1514663160000","original_loc_stanox":"","planned_timestamp":"1514663160000","timetable_variation":"0","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"false","next_report_run_time":"1","reporting_stanox":"00000","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"30","train_terminated":"false","train_id":"722C45MY30","offroute_ind":"false","variation_status":"ON TIME","train_service_code":"22216000","toc_id":"30","loc_stanox":"72001","auto_expected":"true","direction_ind":"UP","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"72004","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514662950000","timetable_variation":"4","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"false","next_report_run_time":"3","reporting_stanox":"00000","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 2","division_code":"88","train_terminated":"false","train_id":"871C40MW30","offroute_ind":"false","variation_status":"LATE","train_service_code":"24748000","toc_id":"88","loc_stanox":"86343","auto_expected":"true","direction_ind":"DOWN","route":"1","planned_event_type":"DEPARTURE","next_report_stanox":"86341","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514663070000","timetable_variation":"1","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"6","reporting_stanox":"87903","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"88","train_terminated":"false","train_id":"871T581Y30","offroute_ind":"false","variation_status":"LATE","train_service_code":"22721000","toc_id":"88","loc_stanox":"87903","auto_expected":"true","direction_ind":"UP","route":"3","planned_event_type":"DEPARTURE","next_report_stanox":"87901","line_ind":"Q"}},{"header":{"msg_type":"0003","source_dev_id":"SRH9","user_id":"#QGE7038","original_data_source":"SDR","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"1514662920000","original_loc_stanox":"","planned_timestamp":"1514662920000","timetable_variation":"2","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"1","reporting_stanox":"18449","actual_timestamp":"1514663040000","correction_ind":"false","event_source":"MANUAL","train_file_address":null,"platform":"","division_code":"23","train_terminated":"false","train_id":"172M60MX30","offroute_ind":"false","variation_status":"LATE","train_service_code":"11871821","toc_id":"23","loc_stanox":"18449","auto_expected":"false","direction_ind":"","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"29002","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514663100000","timetable_variation":"0","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"6","reporting_stanox":"86703","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"27","train_terminated":"false","train_id":"861M78MY30","offroute_ind":"false","variation_status":"ON TIME","train_service_code":"22180010","toc_id":"27","loc_stanox":"86703","auto_expected":"true","direction_ind":"DOWN","route":"2","planned_event_type":"DEPARTURE","next_report_stanox":"86101","line_ind":"B"}},{"header":{"msg_type":"0003","source_dev_id":"SRH9","user_id":"#QGE7038","original_data_source":"SDR","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"1514662920000","original_loc_stanox":"","planned_timestamp":"1514662950000","timetable_variation":"3","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"5","reporting_stanox":"18449","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"MANUAL","train_file_address":null,"platform":"","division_code":"23","train_terminated":"false","train_id":"172M60MX30","offroute_ind":"false","variation_status":"LATE","train_service_code":"11871821","toc_id":"23","loc_stanox":"18449","auto_expected":"false","direction_ind":"","route":"","planned_event_type":"DEPARTURE","next_report_stanox":"29002","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514663220000","timetable_variation":"2","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"1","reporting_stanox":"87927","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"88","train_terminated":"false","train_id":"871A13MY30","offroute_ind":"false","variation_status":"EARLY","train_service_code":"24747000","toc_id":"88","loc_stanox":"87927","auto_expected":"true","direction_ind":"UP","route":"2","planned_event_type":"DEPARTURE","next_report_stanox":"87920","line_ind":"F"}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"1514663160000","original_loc_stanox":"","planned_timestamp":"1514663160000","timetable_variation":"0","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"1","reporting_stanox":"89331","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 2","division_code":"80","train_terminated":"false","train_id":"872Z141W30","offroute_ind":"false","variation_status":"ON TIME","train_service_code":"24605004","toc_id":"80","loc_stanox":"89331","auto_expected":"true","direction_ind":"DOWN","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"89328","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663138000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"1514662980000","original_loc_stanox":"","planned_timestamp":"1514662950000","timetable_variation":"4","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"false","next_report_run_time":"1","reporting_stanox":"00000","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 2","division_code":"80","train_terminated":"false","train_id":"871S561V30","offroute_ind":"false","variation_status":"LATE","train_service_code":"24604004","toc_id":"80","loc_stanox":"89470","auto_expected":"true","direction_ind":"DOWN","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"89473","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663139000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514662920000","timetable_variation":"3","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"3","reporting_stanox":"63201","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 3","division_code":"28","train_terminated":"false","train_id":"251C72MV30","offroute_ind":"false","variation_status":"LATE","train_service_code":"22152000","toc_id":"28","loc_stanox":"63201","auto_expected":"true","direction_ind":"UP","route":"2","planned_event_type":"DEPARTURE","next_report_stanox":"63209","line_ind":"F"}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663139000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514662890000","timetable_variation":"4","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"false","next_report_run_time":"4","reporting_stanox":"00000","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"28","train_terminated":"false","train_id":"551B71MW30","offroute_ind":"false","variation_status":"LATE","train_service_code":"22154000","toc_id":"28","loc_stanox":"63209","auto_expected":"true","direction_ind":"UP","route":"2","planned_event_type":"DEPARTURE","next_report_stanox":"63252","line_ind":"F"}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663139000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"1514663280000","original_loc_stanox":"","planned_timestamp":"1514663250000","timetable_variation":"1","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"3","reporting_stanox":"70261","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 3","division_code":"29","train_terminated":"false","train_id":"722N09MX30","offroute_ind":"false","variation_status":"EARLY","train_service_code":"22209000","toc_id":"29","loc_stanox":"70261","auto_expected":"true","direction_ind":"DOWN","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"70215","line_ind":"3"}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663139000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514662800000","timetable_variation":"6","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"1","reporting_stanox":"32563","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"27","train_terminated":"false","train_id":"321O34MY30","offroute_ind":"false","variation_status":"LATE","train_service_code":"22180014","toc_id":"27","loc_stanox":"32563","auto_expected":"true","direction_ind":"","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"32571","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663139000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"1514662920000","original_loc_stanox":"","planned_timestamp":"1514662920000","timetable_variation":"3","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"4","reporting_stanox":"38302","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 2","division_code":"64","train_terminated":"false","train_id":"402C531W30","offroute_ind":"false","variation_status":"LATE","train_service_code":"22306003","toc_id":"64","loc_stanox":"38302","auto_expected":"true","direction_ind":"UP","route":"2","planned_event_type":"DEPARTURE","next_report_stanox":"38304","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663139000","source_system_id":"TRUST"},"body":{"event_type":"ARRIVAL","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514662950000","timetable_variation":"4","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"1","reporting_stanox":"06701","actual_timestamp":"1514663160000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"60","train_terminated":"false","train_id":"062H04MX30","offroute_ind":"false","variation_status":"LATE","train_service_code":"13560015","toc_id":"60","loc_stanox":"06701","auto_expected":"true","direction_ind":"","route":"0","planned_event_type":"ARRIVAL","next_report_stanox":"06707","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663139000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"","original_loc_stanox":"","planned_timestamp":"1514662920000","timetable_variation":"3","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"false","next_report_run_time":"4","reporting_stanox":"00000","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":"","division_code":"64","train_terminated":"false","train_id":"365D30MY30","offroute_ind":"false","variation_status":"LATE","train_service_code":"12304212","toc_id":"64","loc_stanox":"36078","auto_expected":"true","direction_ind":"DOWN","route":"2","planned_event_type":"DEPARTURE","next_report_stanox":"36076","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663140000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"1514663100000","original_loc_stanox":"","planned_timestamp":"1514663100000","timetable_variation":"0","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"true","next_report_run_time":"6","reporting_stanox":"00000","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 1","division_code":"21","train_terminated":"false","train_id":"502K821Y30","offroute_ind":"false","variation_status":"ON TIME","train_service_code":"21943001","toc_id":"21","loc_stanox":"50327","auto_expected":"true","direction_ind":"DOWN","route":"3","planned_event_type":"DEPARTURE","next_report_stanox":"50324","line_ind":""}},{"header":{"msg_type":"0003","source_dev_id":"","user_id":"","original_data_source":"SMART","msg_queue_timestamp":"1514663140000","source_system_id":"TRUST"},"body":{"event_type":"DEPARTURE","gbtt_timestamp":"1514663100000","original_loc_stanox":"","planned_timestamp":"1514663100000","timetable_variation":"0","original_loc_timestamp":"","current_train_id":"","delay_monitoring_point":"false","next_report_run_time":"3","reporting_stanox":"00000","actual_timestamp":"1514663100000","correction_ind":"false","event_source":"AUTOMATIC","train_file_address":null,"platform":" 2","division_code":"88","train_terminated":"false","train_id":"872R04MX30","offroute_ind":"false","variation_status":"ON TIME","train_service_code":"24784000","toc_id":"88","loc_stanox":"87678","auto_expected":"true","direction_ind":"DOWN","route":"2","planned_event_type":"DEPARTURE","next_report_stanox":"87679","line_ind":""}}]"""
}
